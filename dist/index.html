<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Telechart</title>
    <!-- CSS Reset from meyerweb for demonstration purposes only, not related to the library -->
    <link rel="stylesheet" type="text/css" href="/reset.css" />
    <!-- <link
      href="https://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
    /> -->
    <!-- <link rel="stylesheet" type="text/css" href="/telechart.css" /> -->
    <link rel="stylesheet" type="text/css" href="/index.css" />
  </head>
  <body>
    <div class="demo">
      <h1>telechart.js</h1>
      <h2>Made for Stage 2 of the Telegram's Chart Coding Competition</h1>
      <div id="chart1" class="chart"></div>
      <div id="chart2" class="chart"></div>
      <div id="chart3" class="chart"></div>
      <div id="chart4" class="chart"></div>
      <div id="chart5" class="chart"></div>
      <div class="switch">Switch to Night Mode</div>
    </div>

    <script src="/telechart.polyfill.js" type="text/javascript"></script>
    <script src="/telechart.js" type="text/javascript"></script>
    <script>
      // Cross-browser DOM ready
      window.ready = function(a, b, c) {
        (b = document), (c = "addEventListener");
        b[c] ? b[c]("DOMContentLoaded", a) : window.attachEvent("onload", a);
      };
    </script>
    <script>
      // Toggles between night/day mode
      window.ready(function() {
        var day = true;
        var demo = document.getElementsByClassName("demo")[0];
        var switcher = document.getElementsByClassName("switch")[0];

        switcher.addEventListener("click", function switchHandler(e) {
          day = !day;

          if (day) {
            switcher.textContent = "Switch to Night Mode";
            demo.classList.remove("night");
          } else {
            switcher.textContent = "Switch to Day Mode";
            demo.classList.add("night");
          }
        });
      });
    </script>
    <script>
      window.ready(function() {
        // Chart initialization
        const fetchData = path =>
          fetch(`/data/${path}`).then(function(response) {
            return response.json();
          });

        const customMount = (target, name) => components => {
          // Compose your DOM tree as you like
          target.classList.add("tc-wrapper");

          const headerWrapper = document.createElement("div");
          headerWrapper.className = "chart__header";

          const header = document.createElement("h3");
          header.appendChild(document.createTextNode(name));
          headerWrapper.appendChild(header);
          headerWrapper.appendChild(components.range);

          target.appendChild(headerWrapper);
          target.appendChild(components.view);
          target.appendChild(components.preview);
          if (components.controls) target.appendChild(components.controls);
        };

        const charts = [];
        fetchData("1/overview.json").then(function(json) {
          const target = document.getElementById("chart1");
          const controller = telechart(json)
            // pass custom DOM handler or target element
            .mount(customMount(target, "Followers"));
        });
        fetchData("2/overview.json").then(function(json) {
          const target = document.getElementById("chart2");
          const controller = telechart(json)
            // pass custom DOM handler or target element
            .mount(customMount(target, "Interactions"));
        });
        fetchData("3/overview.json").then(function(json) {
          const target = document.getElementById("chart3");
          const controller = telechart(json)
            // pass custom DOM handler or target element
            .mount(customMount(target, "Views"));
        });
        fetchData("4/overview.json").then(function(json) {
          const target = document.getElementById("chart4");
          const controller = telechart(json)
            // pass custom DOM handler or target element
            .mount(customMount(target, "Messages"));
        });
        fetchData("5/overview.json").then(function(json) {
          const target = document.getElementById("chart5");
          const controller = telechart(json)
            // pass custom DOM handler or target element
            .mount(customMount(target, "Apps"));
        });
      });
    </script>
  </body>
</html>
