<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Telechart</title>
    <!-- CSS Reset from meyerweb for demonstration purposes only, not related to the library -->
    <link rel="stylesheet" type="text/css" href="/reset.css" />
    <!-- <link
      href="https://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
    /> -->
    <!-- <link rel="stylesheet" type="text/css" href="/telechart.css" /> -->
    <link rel="stylesheet" type="text/css" href="/index.css" />
  </head>
  <body>
    <div class="demo">
      <h1>telechart.js</h1>
      <h2>Made for Stage 2 of the Telegram's Chart Coding Competition</h1>
      <div id="chart1" class="chart"></div>
      <div id="chart2" class="chart"></div>
      <div id="chart3" class="chart"></div>
      <div id="chart4" class="chart"></div>
      <div id="chart5" class="chart"></div>
      <div class="switch">Switch to Night Mode</div>
      <footer>
        <div>By <a href="https://github.com/vladislao">Vladislav Stroev</a></div>
        <a href="https://github.com/vladislao/telechart">sources</a>
      </footer>
    </div>

    <script src="/telechart.polyfill.js" type="text/javascript"></script>
    <script src="/telechart.js" type="text/javascript"></script>
    <script>
      // Cross-browser DOM ready
      var ready = function(a, b, c) {
        (b = document), (c = "addEventListener");
        b[c] ? b[c]("DOMContentLoaded", a) : window.attachEvent("onload", a);
      };

      ready(function() {
        // Fetch helper
        var fetchData = path =>
          fetch(`/data/${path}`).then(function(response) {
            return response.json();
          });

        // Compose your DOM tree as you like
        var customMount = function(target, name) {
          return function (components) {
            target.classList.add("tc-wrapper");

            var headerWrapper = document.createElement("div");
            headerWrapper.className = "chart__header";

            var header = document.createElement("h3");
            header.appendChild(document.createTextNode(name));
            headerWrapper.appendChild(header);
            headerWrapper.appendChild(components.range);

            target.appendChild(headerWrapper);
            target.appendChild(components.view);
            target.appendChild(components.preview);
            if (components.controls) target.appendChild(components.controls);
          }
        };

        // Some common theme settings
        var setCommonTheme = function(day, engine, state) {
          state.window.mask.color.hex = day ? "#E2EEF9" : "#304259";
          state.window.mask.color.alpha = 0.6;
          state.window.tracker.color.hex = day ? "#C0D1E1" : "#56626D";
          state.window.tracker.color.alpha = 1;
          state.grid.color.hex = day ? "#182D3B" : "#FFFFFF";
          state.grid.color.alpha = 0.1;
        }

        var listeners = [];
        var onThemeChange = function(day) {
          listeners.forEach(v => v(day));
        }

        fetchData("1/overview.json").then(function(json) {
          var setTheme = function(day) {
            return function (engine, state) {
              setCommonTheme(day, engine, state);
              state.axis.color.hex = day ? "#8E8E93" : "#A3B1C2";
              state.axis.color.alpha = day ? 1 : 0.6;
            }
          };

          var target = document.getElementById("chart1");
          // Chart initialization
          var controller = telechart(json)
            // pass custom DOM handler or target element
            .update(setTheme(true))
            .mount(customMount(target, "Followers"));

          listeners.push(function (day) {
            controller
              .update(setTheme(day))
              .render()
          });
        });
        fetchData("2/overview.json").then(function(json) {
          var setTheme = function(day) {
            return function (engine, state) {
              setCommonTheme(day, engine, state);
              state.axis.color.hex = day ? "#8E8E93" : "#A3B1C2";
              state.axis.color.alpha = day ? 1 : 0.6;
            }
          };

          var target = document.getElementById("chart2");
          var controller = telechart(json)
            .update(setTheme(true))
            .mount(customMount(target, "Interactions"));

          listeners.push(function (day) {
            controller
              .update(setTheme(day))
              .render()
          });
        });
        fetchData("3/overview.json").then(function(json) {
          var setTheme = function(day) {
            return function (engine, state) {
              setCommonTheme(day, engine, state);
              state.axis.color.hex = day ? "#252529" : "#A3B1C2";
              state.axis.color.alpha = day ? 0.5 : 0.6;
            }
          };

          var target = document.getElementById("chart3");
          var controller = telechart(json)
            .update(setTheme(true))
            .mount(customMount(target, "Messages"));

          listeners.push(function (day) {
            controller
              .update(setTheme(day))
              .render(true)
          });
        });
        fetchData("4/overview.json").then(function(json) {
          var setTheme = function(day) {
            return function (engine, state) {
              setCommonTheme(day, engine, state);
              state.axis.color.hex = day ? "#252529" : "#A3B1C2";
              state.axis.color.alpha = day ? 0.5 : 0.6;
            }
          };

          var target = document.getElementById("chart4");
          var controller = telechart(json)
            .update(setTheme(true))
            .mount(customMount(target, "Views"));

          listeners.push(function (day) {
            controller
              .update(setTheme(day))
              .render()
          });
        });
        fetchData("5/overview.json").then(function(json) {
          var setTheme = function(day) {
            return function (engine, state) {
              setCommonTheme(day, engine, state);
              state.axis.color.hex = day ? "#252529" : "#A3B1C2";
              state.axis.color.alpha = day ? 0.5 : 0.6;
            }
          };

          var target = document.getElementById("chart5");
          var controller = telechart(json)
            .update(setTheme(true))
            .mount(customMount(target, "Apps"));

          listeners.push(function (day) {
            controller
              .update(setTheme(day))
              .render()
          });
        });


        // Toggles between night/day mode
        (function() {
          var day = true;
          var demo = document.getElementsByClassName("demo")[0];
          var switcher = document.getElementsByClassName("switch")[0];

          switcher.addEventListener("click", function switchHandler(e) {
            day = !day;

            if (day) {
              switcher.textContent = "Switch to Night Mode";
              demo.classList.remove("night");
              onThemeChange(day);
            } else {
              switcher.textContent = "Switch to Day Mode";
              demo.classList.add("night");
              onThemeChange(day);
            }
          });
        })();
      });
    </script>
  </body>
</html>
